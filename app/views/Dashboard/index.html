#{extends 'main.html' /}
#{set title:member.displayName + ' - Dashboard Link-IT' /}
#{set 'moreScripts'}
<script src="http://widgets.twimg.com/j/2/widget.js"></script>
#{/set}
<div class="container">
    <div class="hero-unit">
        <h2>Your dashboard</h2>
        <div class="row">
            <div class="span6">
                <!-- profil -->
                #{if member.email}
                #{gravatar.img member.email, size:120, default:'mm', rating:'pg', secure:true/}
                #{/if}
                #{if member instanceof models.Speaker}
                <h5>Session${member.sessions.size().pluralize()} :</h5>
                <p>
                    #{list items:member.sessions, as:'talk'}
                <h5><a href="@{Sessions.show(talk.id)}">${talk.title}</a></h5>
                #{/list}
                </p>
                #{/if}
                <p>
                <a href="@{Profile.show(session.username)}">Voir mon profil</a>
                <a href="@{Profile.edit(session.username)}">Editer mon profil</a>
                </p>
                
                #{if member.links}
                <div class="row">
                    <div class="span6">
                        <h3>Vous êtes lié à :</h3>
                        #{list items:member.links, as:'link'}       
                        <a href="@{Profile.show(link.login)}" rel='twipsy' title='${link}'>#{gravatar.img link.email, size:24, default:'mm', rating:'pg', secure:true/}</a>
                        #{/list}
                    </div>
                </div>
                #{/if}
                #{if member.linkers}
                <div class="row">
                    <div class="span6">
                        <h3>Ils vous ont lié :</h3>
                        #{list items:member.linkers, as:'link'}
                        <a href="@{Profile.show(link.login)}" rel='twipsy' title="${link}">#{gravatar.img link.email, size:24, default:'mm', rating:'pg', secure:true/}</a>
                        #{/list}
                    </div>
                </div>
                #{/if}
                #{if suggests}
                <div class="row">
                    <div class="span6">
                        <h3>Suggestions de liens :</h3>
                        #{list items:suggests, as:'suggest'}
                            <a href="@{Profile.show(suggest.login)}" rel='twipsy' title="${suggest}">#{gravatar.img suggest.email, size:24, default:'mm', rating:'pg', secure:true/}</a>
                            <a class="btn primary small" title="Link" href="@{Profile.link(session.get("username"), suggest.login)}">+</a>
                            <br/>
                        #{/list}
                    </div>
                </div>
                #{/if}
            </div>

            <div class="span8" > <!-- timeline -->
                <h2>Timeline entrante</h2>
                <div class="alert-message warning">
                    <p><strong>Cette timeline sera à terme celle de ceux linkés.</strong> Actuellement, elle est identique à celle du profil</p>
                </div>
                <div id="activities" style="max-height: 400px">
                </div>
                <a id="moreActivities" href="#activities" class="btn small" onclick="loadMoreActivities()">&{'activities.more'}</a>

                <script type="text/javascript">
                    var page = 1;
                    var size = 10;
                    var activitiesAction = #{jsAction @Profile.activities(':login', ':page',':size') /};

                    function loadMoreActivities() {
                        $.get(activitiesAction({login: '${member.login}', page: page, size: size}), function(data) {
                            $('#activities').append(data);
                            if (data) {
                                page++;
                            } else {
                                $('#moreActivities').css('visibility','hidden');
                            }
                        });    
                    }

                    // Initial loading : first page
                    loadMoreActivities();
                </script>            
            </div>
        </div>
    </div>
</div>